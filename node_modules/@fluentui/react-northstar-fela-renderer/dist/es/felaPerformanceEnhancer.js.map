{"version":3,"sources":["felaPerformanceEnhancer.ts"],"names":["cssifyDeclaration","generateCombinedMediaQuery","generateCSSSelector","isMediaQuery","isNestedSelector","isSupport","isUndefinedValue","normalizeNestedProperty","RULE_TYPE","isPlainObject","val","Array","isArray","chars","charLength","length","generateUniqueClassName","id","className","generateClassName","getId","filterClassName","startId","generatedClassName","generateDeclarationReference","property","value","pseudo","media","support","felaPerformanceEnhancer","renderer","_renderStyleToClassNames","_className","style","classNames","combinedMediaQuery","slice","trim","combinedSupport","console","warn","declarationReference","cache","hasOwnProperty","selectorPrefix","getNextRuleIdentifier","declaration","selector","change","type","_emitChange","cachedClassName"],"mappings":"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","sourcesContent":["//\n// This file is one-to-one copy-paste from Fela source code. It includes `_renderStyleToClassNames()` and all\n// non-exported utils.\n// A single change is only one line inside `generateDeclarationReference()`.\n//\n\nimport { ICSSInJSStyle } from '@fluentui/styles';\n// @ts-ignore\nimport cssifyDeclaration from 'css-in-js-utils/lib/cssifyDeclaration';\nimport {\n  // @ts-ignore\n  generateCombinedMediaQuery,\n  // @ts-ignore\n  generateCSSSelector,\n  // @ts-ignore\n  isMediaQuery,\n  // @ts-ignore\n  isNestedSelector,\n  // @ts-ignore\n  isSupport,\n  // @ts-ignore\n  isUndefinedValue,\n  // @ts-ignore\n  normalizeNestedProperty,\n  RULE_TYPE,\n} from 'fela-utils';\n\nimport { FelaRenderer, FelaRendererChange } from './types';\n\nfunction isPlainObject(val: any) {\n  return val != null && typeof val === 'object' && Array.isArray(val) === false;\n}\n\nconst chars = 'abcdefghijklmnopqrstuvwxyz';\nconst charLength = chars.length;\n\nfunction generateUniqueClassName(id: number, className: string = ''): string {\n  if (id <= charLength) {\n    return chars[id - 1] + className;\n  }\n\n  // Bitwise floor as safari performs much faster\n  // https://jsperf.com/math-floor-vs-math-round-vs-parseint/55\n  return generateUniqueClassName((id / charLength) | 0, chars[id % charLength] + className);\n}\n\nfunction generateClassName(getId: Function, filterClassName: Function = () => true): string {\n  const startId = getId();\n  const generatedClassName = generateUniqueClassName(startId);\n\n  if (!filterClassName(generatedClassName)) {\n    return generateClassName(getId, filterClassName);\n  }\n\n  return generatedClassName;\n}\n\nfunction generateDeclarationReference(\n  property: string,\n  value: any,\n  pseudo: string = '',\n  media: string = '',\n  support: string = '',\n): string {\n  //\n  // This a single perf change here, it removes `camelCaseProperty()` call\n  //\n\n  // CHANGE:START\n  return support + media + pseudo + property + value;\n  // CHANGE:END\n}\n\n//\n\nexport function felaPerformanceEnhancer(renderer: FelaRenderer) {\n  renderer._renderStyleToClassNames = function _renderStyleToClassNames(\n    { _className, ...style }: ICSSInJSStyle & { _className?: string },\n    pseudo: string = '',\n    media: string = '',\n    support: string = '',\n  ): string {\n    let classNames = _className ? ` ${_className}` : '';\n\n    for (const property in style) {\n      const value = style[property as keyof ICSSInJSStyle];\n\n      if (isPlainObject(value)) {\n        if (isNestedSelector(property)) {\n          classNames += renderer._renderStyleToClassNames(\n            value as any,\n            pseudo + normalizeNestedProperty(property),\n            media,\n            support,\n          );\n        } else if (isMediaQuery(property)) {\n          const combinedMediaQuery = generateCombinedMediaQuery(media, property.slice(6).trim());\n          classNames += renderer._renderStyleToClassNames(value as any, pseudo, combinedMediaQuery, support);\n        } else if (isSupport(property)) {\n          const combinedSupport = generateCombinedMediaQuery(support, property.slice(9).trim());\n          classNames += renderer._renderStyleToClassNames(value as any, pseudo, media, combinedSupport);\n        } else {\n          // eslint-disable-next-line no-console\n          console.warn(`The object key \"${property}\" is not a valid nested key in Fela.\nMaybe you forgot to add a plugin to resolve it?\nCheck http://fela.js.org/docs/basics/Rules.html#styleobject for more information.`);\n        }\n      } else {\n        const declarationReference = generateDeclarationReference(property, value, pseudo, media, support);\n\n        if (!renderer.cache.hasOwnProperty(declarationReference)) {\n          // we remove undefined values to enable\n          // usage of optional props without side-effects\n          if (isUndefinedValue(value)) {\n            renderer.cache[declarationReference] = {\n              className: '',\n            } as FelaRendererChange;\n            /* eslint-disable no-continue */\n            continue;\n            /* eslint-enable */\n          }\n\n          const className =\n            renderer.selectorPrefix + generateClassName(renderer.getNextRuleIdentifier, renderer.filterClassName);\n\n          const declaration = cssifyDeclaration(property, value);\n          const selector = generateCSSSelector(className, pseudo);\n\n          const change = {\n            type: RULE_TYPE,\n            className,\n            selector,\n            declaration,\n            pseudo,\n            media,\n            support,\n          };\n\n          renderer.cache[declarationReference] = change;\n          renderer._emitChange(change);\n        }\n\n        const cachedClassName = renderer.cache[declarationReference].className;\n\n        // only append if we got a class cached\n        if (cachedClassName) {\n          classNames += ` ${cachedClassName}`;\n        }\n      }\n    }\n\n    return classNames;\n  };\n\n  return renderer;\n}\n"],"file":"felaPerformanceEnhancer.js"}